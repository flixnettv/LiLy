<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Lily Label - AI Design Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Cairo:wght@400;700;900&family=Roboto:wght@700&family=Lato:wght@700&family=Montserrat:wght@700&family=Oswald:wght@700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
      :root {
        --glass-bg: rgba(30, 41, 59, 0.7);
        --glass-border: rgba(255, 255, 255, 0.1);
        --accent-gradient: linear-gradient(135deg, #58a6ff 0%, #3b82f6 100%);
      }
      body { 
        font-family: 'Nunito', sans-serif; 
        height: 100vh; /* Lock height */
        width: 100vw; /* Lock width */
        overflow: hidden; /* Prevent scrolling */
        background: radial-gradient(circle at top right, #1e293b, #0f172a);
      }
      html[dir="rtl"] body { font-family: 'Cairo', sans-serif; }
      [dir="rtl"] .rtl-icon-fix { transform: scaleX(-1); }
      
      /* Glassmorphism Classes */
      .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
      }

      .error-toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translate(-50%, 20px);
        background-color: #dc2626;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .category-btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .category-btn:not(.active):hover {
        transform: translateY(-2px);
        background: rgba(255,255,255,0.05);
      }
      .category-btn.active {
        background: var(--accent-gradient) !important;
        border-color: transparent !important;
        color: white !important;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        transform: scale(1.05);
      }
      
      /* Canvas Container */
      #canvas-wrapper {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
      }

      /* Custom Scrollbar for inner content */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); }

      /* Animation classes */
      .animate-fade-in { animation: fadeIn 0.3s ease forwards; }
      .animate-scale-in { animation: scaleIn 0.3s ease forwards; }
      .animate-fade-out { animation: fadeOut 0.3s ease forwards; }
      .animate-scale-out { animation: scaleOut 0.3s ease forwards; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
      @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
      @keyframes scaleOut { from { transform: scale(1); opacity: 1; } to { transform: scale(0.95); opacity: 0; } }

    </style>
    <link rel="stylesheet" href="index.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  </head>

  <body class="text-white antialiased flex flex-col">

    <!-- Header (Fixed Height) -->
    <header class="h-16 shrink-0 glass-panel border-b-0 border-b-white/10 z-40 relative shadow-lg">
      <div class="h-full container mx-auto px-4 flex items-center justify-between">
        <div class="flex items-center">
          <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center shadow-lg">
             <i class="fas fa-magic text-white text-lg"></i>
          </div>
          <!-- Title is HARDCODED in English as requested -->
          <h1 class="text-lg md:text-xl font-black ml-3 tracking-wide bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">
            Lily Label AI Designer
          </h1>
        </div>
        <div class="flex items-center gap-3">
          <button id="lang-switcher" class="px-3 py-1 rounded-full border border-white/20 hover:bg-white/10 text-xs md:text-sm transition-colors font-semibold"></button>
          <button id="cart-btn" class="relative w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors">
            <i class="fas fa-shopping-bag text-xl"></i>
            <span id="cart-count" class="absolute top-1 right-1 bg-gradient-to-r from-red-500 to-pink-500 text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center shadow-sm">0</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content (Fills remaining height) -->
    <main class="flex-grow relative overflow-hidden flex flex-col">
      
      <!-- Start Screen (Centered, no scroll) -->
      <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center p-6 text-center z-10 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-800/50 to-transparent">
        <div class="glass-panel p-8 md:p-12 rounded-3xl max-w-2xl w-full shadow-2xl border border-white/5 animate-scale-in">
          <div class="mb-6 inline-block p-4 rounded-full bg-blue-500/10 text-blue-400">
             <i class="fas fa-paint-brush text-4xl"></i>
          </div>
          <h2 class="text-3xl md:text-5xl font-black tracking-tight mb-4" data-lang-key="startTitle">What should we design today?</h2>
          <p class="text-base md:text-lg text-gray-400 mb-8" data-lang-key="startSubtitle">Create amazing designs for your labels and products.</p>
          <button id="start-design-btn" class="group relative inline-flex items-center justify-center px-8 py-4 text-base md:text-lg font-bold text-white transition-all duration-200 bg-gradient-to-r from-blue-600 to-blue-400 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600 hover:shadow-lg hover:shadow-blue-500/30 hover:scale-105" data-lang-key="startBtn">
            Design Your Label Now <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform rtl-icon-fix"></i>
          </button>
        </div>
      </div>

      <!-- Main Editor (Split Layout, no body scroll) -->
      <div id="main-editor" class="hidden absolute inset-0 flex flex-col lg:flex-row">
        
        <!-- Canvas Area (Dominant space) -->
        <div class="flex-grow relative bg-[#0f172a] flex items-center justify-center p-4 lg:p-8 overflow-hidden">
             <!-- Background pattern -->
             <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#3b82f6 1px, transparent 1px); background-size: 20px 20px;"></div>
             
             <!-- Toolbar Header on Mobile -->
             <div class="absolute top-4 left-4 z-20 lg:hidden">
                <button id="back-btn-mobile" class="w-10 h-10 rounded-full glass-panel flex items-center justify-center text-white shadow-lg active:scale-95 transition-transform">
                  <i class="fas fa-arrow-left rtl-icon-fix"></i>
                </button>
             </div>

             <div id="canvas-wrapper" class="relative shadow-2xl border-[4px] border-white/5 rounded-lg overflow-hidden">
                <canvas id="design-canvas"></canvas>
            </div>
        </div>

        <!-- Controls Area (Sidebar on Desktop, Bottom Sheet on Mobile) -->
        <div class="shrink-0 w-full lg:w-96 glass-panel lg:border-l lg:border-t-0 border-t border-white/10 flex flex-col z-20 shadow-[-10px_0_30px_rgba(0,0,0,0.5)]">
            
            <!-- Desktop Header -->
            <div class="hidden lg:flex justify-between items-center p-5 border-b border-white/10">
              <h2 class="text-lg font-bold flex items-center gap-2"><i class="fas fa-sliders-h text-blue-400"></i> <span data-lang-key="customizeText">Customize</span></h2>
              <button id="back-btn" class="text-xs bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-full transition-colors border border-white/10" data-lang-key="back">Back</button>
            </div>

            <!-- Scrollable Controls Content -->
            <div class="flex-grow overflow-y-auto p-5 space-y-5 custom-scrollbar">
              
              <!-- Input Group -->
              <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                <label class="text-xs font-bold text-gray-400 uppercase mb-2 block" data-lang-key="studentName">Name</label>
                <div class="relative">
                    <input type="text" id="student-name" class="w-full bg-black/20 border border-white/10 rounded-lg pl-3 pr-10 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition text-white placeholder-gray-500" data-lang-placeholder-key="studentName">
                    <i class="fas fa-pen absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                </div>
              </div>

              <!-- Font & Color Group -->
              <div class="grid grid-cols-2 gap-3">
                  <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                    <label class="text-xs font-bold text-gray-400 uppercase mb-2 block" data-lang-key="fontFamily">Font</label>
                    <button id="font-family-btn" class="w-full bg-black/20 hover:bg-black/40 border border-white/10 rounded-lg p-2 text-sm text-center transition flex justify-between items-center px-3 h-10">
                      <span class="truncate">Nunito</span> <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                  </div>
                  <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                     <label class="text-xs font-bold text-gray-400 uppercase mb-2 block" data-lang-key="fontColor">Color</label>
                     <div class="relative h-10 w-full rounded-lg overflow-hidden border border-white/10">
                        <input type="color" id="font-color" value="#000000" class="absolute -top-1/2 -left-1/2 w-[200%] h-[200%] cursor-pointer p-0 border-0">
                     </div>
                  </div>
              </div>

              <!-- Size Slider -->
              <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs font-bold text-gray-400 uppercase" data-lang-key="fontSize">Size</label>
                    <span id="font-size-value" class="text-xs font-mono bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded">60px</span>
                </div>
                <input type="range" id="font-size" min="10" max="150" value="60" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
              </div>

            </div>

            <!-- Footer Action -->
            <div class="p-5 border-t border-white/10 bg-black/20 shrink-0">
              <button id="add-to-cart-btn" class="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 disabled:from-gray-700 disabled:to-gray-800 disabled:cursor-not-allowed font-bold rounded-xl shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 text-white" data-lang-key="addToCart">
                <i class="fas fa-cart-plus"></i> <span data-lang-key="addToCart">Add to Cart</span>
              </button>
            </div>
        </div>

      </div>
    </main>

    <!-- Modals (Improved Backdrop & Animation) -->

    <!-- Info Modal -->
    <div id="info-modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4 backdrop-blur-md bg-black/60">
        <div class="glass-panel rounded-3xl w-full max-w-lg p-0 flex flex-col max-h-[90vh] shadow-2xl animate-scale-in">
            <!-- Modal Header -->
            <div class="p-5 border-b border-white/10 flex justify-between items-center bg-white/5">
                <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-user-edit text-blue-400"></i> <span data-lang-key="enterDetails">Details</span></h2>
                <div class="flex gap-2">
                   <button id="info-back-btn" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors"><i class="fas fa-arrow-left rtl-icon-fix"></i></button>
                   <button id="close-info-modal-btn" class="w-8 h-8 rounded-full bg-white/5 hover:bg-red-500/20 hover:text-red-400 flex items-center justify-center transition-colors"><i class="fas fa-times"></i></button>
                </div>
            </div>
            
            <!-- Scrollable Content -->
            <div class="overflow-y-auto p-6 space-y-6 custom-scrollbar">
                <!-- Product Type -->
                <div>
                  <p class="font-bold text-sm text-gray-400 uppercase mb-3" data-lang-key="productType">1. Product Type</p>
                  <div class="grid grid-cols-3 gap-3">
                      <button class="category-btn flex flex-col items-center justify-center p-3 bg-white/5 rounded-xl border border-white/10 aspect-square" data-category="sticker"><i class="fas fa-sticky-note text-2xl mb-2 text-[#87CEEB]"></i><span class="text-xs text-center leading-tight" data-lang-key="sticker"></span></button>
                      <button class="category-btn flex flex-col items-center justify-center p-3 bg-white/5 rounded-xl border border-white/10 aspect-square" data-category="notebook"><i class="fas fa-book text-2xl mb-2 text-[#F08080]"></i><span class="text-xs text-center leading-tight" data-lang-key="notebook"></span></button>
                      <button class="category-btn flex flex-col items-center justify-center p-3 bg-white/5 rounded-xl border border-white/10 aspect-square" data-category="lunchbox"><i class="fas fa-utensils text-2xl mb-2 text-[#90EE90]"></i><span class="text-xs text-center leading-tight" data-lang-key="lunchbox"></span></button>
                      <button class="category-btn flex flex-col items-center justify-center p-3 bg-white/5 rounded-xl border border-white/10 aspect-square" data-category="wristpad"><i class="fas fa-mouse text-2xl mb-2 text-[#DDA0DD]"></i><span class="text-xs text-center leading-tight" data-lang-key="wristpad"></span></button>
                      <button class="category-btn flex flex-col items-center justify-center p-3 bg-white/5 rounded-xl border border-white/10 aspect-square" data-category="id_tag"><i class="fas fa-id-card text-2xl mb-2 text-[#FFD700]"></i><span class="text-xs text-center leading-tight" data-lang-key="id_tag"></span></button>
                  </div>
                </div>

                <!-- Inputs -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1" data-lang-key="studentName">Student Name</label>
                    <input type="text" id="info-name" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 focus:border-blue-500 transition" data-lang-placeholder-key="nameRequired">
                  </div>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs font-bold text-gray-400 uppercase mb-1" data-lang-key="grade">Grade</label>
                      <select id="info-grade" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 focus:border-blue-500 transition appearance-none"></select>
                    </div>
                    <div>
                      <label class="block text-xs font-bold text-gray-400 uppercase mb-1" data-lang-key="year">Year</label>
                      <select id="info-year" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 focus:border-blue-500 transition appearance-none"></select>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-5 border-t border-white/10 bg-white/5">
                <button id="submit-info-btn" class="w-full py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 disabled:opacity-50 disabled:cursor-not-allowed font-bold rounded-xl shadow-lg transition-transform active:scale-95 text-white" data-lang-key="continueToBackground">Continue</button>
            </div>
        </div>
    </div>
    
    <!-- Image Library Modal -->
    <div id="image-library-modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4 backdrop-blur-md bg-black/80">
        <div class="glass-panel rounded-3xl w-full max-w-5xl h-[85vh] flex flex-col shadow-2xl animate-scale-in">
            <div class="p-5 border-b border-white/10 flex justify-between items-center bg-white/5 shrink-0">
                <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-images text-purple-400"></i> <span data-lang-key="imageLibrary">Library</span></h2>
                <div class="flex gap-2">
                   <button id="library-back-btn" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors"><i class="fas fa-arrow-left rtl-icon-fix"></i></button>
                   <button id="close-library-modal-btn" class="w-8 h-8 rounded-full bg-white/5 hover:bg-red-500/20 hover:text-red-400 flex items-center justify-center transition-colors"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto p-6 custom-scrollbar">
                <div id="image-library-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Images will be injected here -->
                </div>
                <div id="load-more-container" class="mt-8 text-center pb-4"></div>
            </div>
        </div>
    </div>


    <!-- Font Selection Modal -->
    <div id="font-modal" class="hidden fixed inset-0 z-50 items-end sm:items-center justify-center sm:p-4 backdrop-blur-sm bg-black/60">
      <div class="glass-panel rounded-t-3xl sm:rounded-3xl w-full max-w-sm p-6 space-y-4 shadow-2xl animate-scale-in">
        <h2 class="text-xl font-bold text-center border-b border-white/10 pb-3" data-lang-key="selectFont">Select Typography</h2>
        <div id="font-list" class="max-h-60 overflow-y-auto space-y-2 pr-2 custom-scrollbar"></div>
        <button onclick="document.getElementById('font-modal').click()" class="w-full py-3 bg-gray-700/50 hover:bg-gray-700 rounded-xl font-semibold mt-2">Close</button>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4 backdrop-blur-md bg-black/80">
      <div class="glass-panel rounded-3xl w-full max-w-2xl h-[80vh] flex flex-col shadow-2xl animate-scale-in">
        <div class="p-5 border-b border-white/10 flex justify-between items-center bg-white/5 shrink-0">
          <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-shopping-cart text-green-400"></i> <span data-lang-key="cartTitle">Your Cart</span></h2>
          <button id="close-cart-btn" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors"><i class="fas fa-times"></i></button>
        </div>
        <div id="empty-cart-msg" class="flex-grow flex flex-col items-center justify-center text-gray-500">
            <div class="w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-4">
                <i class="fas fa-shopping-basket text-4xl opacity-50"></i>
            </div>
            <p data-lang-key="emptyCart">Your cart is empty.</p>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto p-4 space-y-3 custom-scrollbar"></div>
        <div id="cart-footer" class="p-5 border-t border-white/10 bg-white/5 shrink-0 hidden">
          <div class="flex justify-between items-center text-xl font-bold mb-4">
            <span data-lang-key="totalPrice" class="text-gray-400 text-sm uppercase">Total</span>
            <span id="cart-total-price" class="text-green-400"></span>
          </div>
          <button id="checkout-btn" class="w-full py-4 bg-[#25D366] hover:bg-[#128C7E] font-bold rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2 text-white" data-lang-key="checkout">
             <span>Checkout via WhatsApp</span> <i class="fab fa-whatsapp text-xl"></i>
          </button>
        </div>
      </div>
    </div>
    
    <script type="module" src="index.js"></script>
  </body>
</html>